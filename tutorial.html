<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial &mdash; Near-Line Data Store Client 1.0.6 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="_static/icon-black.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=c0ddf5a4"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Catalog Organisation" href="catalog_organisation.html" />
    <link rel="prev" title="Step-by-Step guide to setting up the NLDS client on JASMIN" href="step_by_step.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Near-Line Data Store Client
              <img src="_static/nlds.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.0.6
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration File</a></li>
<li class="toctree-l1"><a class="reference internal" href="step_by_step.html">Step-by-Step guide to setting up the NLDS client on JASMIN</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction-to-the-nlds">Introduction to the NLDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-the-nlds-client">Setting up the NLDS client</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-nlds-client-for-the-first-time">Running the NLDS client for the first time</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-the-nlds-data-catalog-is-organised">How the NLDS data catalog is organised</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-help-on-the-nlds-commands">Getting help on the NLDS commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#copying-a-single-file-put-to-the-nlds">Copying a single file (PUT) to the NLDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#copying-a-list-of-files-putlist-to-the-nlds">Copying a list of files (PUTLIST) to the NLDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#querying-the-status-of-a-transaction-stat">Querying the status of a transaction (STAT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#querying-the-file-collections-the-user-holds-on-the-nlds-list">Querying the file collections the user holds on the NLDS (LIST)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#querying-the-files-the-user-holds-on-the-nlds-find">Querying the files the user holds on the NLDS (FIND)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#retrieving-a-single-file-from-the-nlds-get">Retrieving a single file from the NLDS (GET)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#retrieving-a-list-of-files-from-the-nlds-getlist">Retrieving a list of files from the NLDS (GETLIST)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#changing-the-label-of-a-file-collection-meta">Changing the label of a file collection (META)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-tags-to-a-file-collection-meta">Adding tags to a file collection (META)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="catalog_organisation.html">Catalog Organisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="status_codes.html">Status Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_ref.html">Command Line Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="hints_tips.html">Hints and Tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">NLDS License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Near-Line Data Store Client</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tutorial">
<span id="id1"></span><h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this heading"></a></h1>
<p>This page is a tutorial on NLDS covering:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#intro"><span class="std std-ref">Introduction to the NLDS</span></a></p></li>
<li><p><a class="reference internal" href="#client"><span class="std std-ref">Setting up the NLDS client</span></a></p></li>
<li><p><a class="reference internal" href="#first"><span class="std std-ref">Running the NLDS client for the first time</span></a></p></li>
<li><p><a class="reference internal" href="#catalog"><span class="std std-ref">How the NLDS data catalog is organised</span></a></p></li>
<li><p><a class="reference internal" href="#help"><span class="std std-ref">Getting help on the NLDS commands</span></a></p></li>
<li><p><a class="reference internal" href="#put"><span class="std std-ref">Copying a single file (PUT) to the NLDS</span></a></p></li>
<li><p><a class="reference internal" href="#putlist"><span class="std std-ref">Copying a list of files (PUTLIST) to the NLDS</span></a></p></li>
<li><p><a class="reference internal" href="#stat"><span class="std std-ref">Querying the status of a transaction (STAT)</span></a></p></li>
<li><p><a class="reference internal" href="#list"><span class="std std-ref">Querying the file collections the user holds on the NLDS (LIST)</span></a></p></li>
<li><p><a class="reference internal" href="#find"><span class="std std-ref">Querying the files the user holds on the NLDS (FIND)</span></a></p></li>
<li><p><a class="reference internal" href="#label"><span class="std std-ref">Changing the label of a file collection (META)</span></a></p></li>
<li><p><a class="reference internal" href="catalog_organisation.html#tags"><span class="std std-ref">Adding tags to a file collection (META)</span></a></p></li>
</ul>
<section id="introduction-to-the-nlds">
<span id="intro"></span><h2>Introduction to the NLDS<a class="headerlink" href="#introduction-to-the-nlds" title="Permalink to this heading"></a></h2>
<p>The Near-Line Data Store (NLDS) is a multi-tiered storage solution that uses
Object Storage as a front-end cache to a tape library.  Interaction with NLDS is via
a HTTP API, with a Python library and command-line client provided to users for
programmatic or interactive use.</p>
<p>When a user ingests files to the NLDS, the files are first written to the
cache, and a backup is made to tape. When the cache is approaching capacity, a
set of policies is interrogated to determine which files will be removed from
the cache. When a user GETs a file, the NLDS may have to first transfer the file
from tape to the cache, if it has been deleted by the policies. This, in effect,
creates a multi-tiered system of hot (disk), warm (cache) and cold (Tape)
storage, with a common interface to all. Additionally, and more importantly, it
takes the decision of storage location out of the user’s hands; the user only
needs to interact with the service itself rather than manually specifying the
movement of data between disk, cache, and tape.</p>
<p>The NLDS also provides a searchable catalog of files, with the user able to
assign a label and tags to a collection of files.</p>
<figure class="align-default" id="id2">
<img alt="_images/userview.png" src="_images/userview.png" />
<figcaption>
<p><span class="caption-text">Figure 1: User view of the Near-Line Data Store</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="setting-up-the-nlds-client">
<span id="client"></span><h2>Setting up the NLDS client<a class="headerlink" href="#setting-up-the-nlds-client" title="Permalink to this heading"></a></h2>
<p>Before using the NLDS, a user must install and set-up the NLDS client.  For the
NLDS installation on JASMIN, the user must also:</p>
<ol class="arabic simple">
<li><p>Have access to the Object Storage tenancy (cache) they wish to write files to.</p></li>
<li><p>Be a member of, and have read/write access to, the Group Workspace they wish
to use for writing to tape.</p></li>
<li><p>The NLDS client is a command-line program with the name <code class="docutils literal notranslate"><span class="pre">nlds</span></code>, which requires
installation into the users homespace, preferably into a Python virtual-environment.
To install <code class="docutils literal notranslate"><span class="pre">nlds</span></code>, refer to the <a class="reference internal" href="installation.html#installation"><span class="std std-ref">installation</span></a> page.</p></li>
</ol>
<p>The <code class="docutils literal notranslate"><span class="pre">nlds</span></code> client program relies on a configuration file stored in the user’s
home directory with the path <code class="docutils literal notranslate"><span class="pre">~/.nlds-config</span></code>.  This contains information
needed to connect the client to the NLDS server.  For more in-depth information, refer
to the <a class="reference internal" href="configuration.html#configuration"><span class="std std-ref">configuration</span></a> page.</p>
<p>The configuration file has the contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;user&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default_user&quot;</span> <span class="p">:</span> <span class="s2">&quot;{{ user_name }}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default_group&quot;</span> <span class="p">:</span> <span class="s2">&quot;{{ user_gws }}&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;server&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;url&quot;</span> <span class="p">:</span> <span class="s2">&quot;{{ nlds_api_url }}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;api&quot;</span> <span class="p">:</span> <span class="s2">&quot;{{ nlds_api_version }}&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;authentication&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;oauth_client_id&quot;</span> <span class="p">:</span> <span class="s2">&quot;{{ oauth_client_id }}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;oauth_client_secret&quot;</span> <span class="p">:</span> <span class="s2">&quot;{{ oauth_client_secret }}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;oauth_token_url&quot;</span> <span class="p">:</span> <span class="s2">&quot;{{ oauth_token_url }}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;oauth_scopes&quot;</span> <span class="p">:</span> <span class="s2">&quot;{{ oauth_scopes }}&quot;&quot;,</span>
        <span class="s2">&quot;oauth_token_file_location&quot;</span> <span class="p">:</span> <span class="s2">&quot;~/.nlds-token&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;object_storage&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;tenancy&quot;</span>    <span class="p">:</span> <span class="s2">&quot;{{ object_store_tenancy }}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;access_key&quot;</span> <span class="p">:</span> <span class="s2">&quot;{{ object_store_access_key }}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;secret_key&quot;</span> <span class="p">:</span> <span class="s2">&quot;{{ object_store_secret_key }}&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;verify_certificates&quot;</span><span class="p">:</span> <span class="n">true</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After installing the client, the <code class="docutils literal notranslate"><span class="pre">nlds</span> <span class="pre">init</span></code> command can be used to fill in the
majority of this file.  The <code class="docutils literal notranslate"><span class="pre">init</span></code> command will fill in:</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">server</span></code> section.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">authentication</span></code> section.</p></li>
</ol>
<p>The user will have to fill in the following sections:</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">user_name</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">user_gws</span></code>.</p></li>
<li><p>The value of the <code class="docutils literal notranslate"><span class="pre">oauth_token_file_location</span></code> field in the <code class="docutils literal notranslate"><span class="pre">authentication</span></code> section can be changed to a location of the user’s choosing.</p></li>
<li><p>Fields in the <code class="docutils literal notranslate"><span class="pre">object_storage</span></code> section are generated by the user interacting with the object storage portal to generate the <code class="docutils literal notranslate"><span class="pre">access_key</span></code> and <code class="docutils literal notranslate"><span class="pre">secret_key</span></code> values.</p></li>
</ol>
</section>
<section id="running-the-nlds-client-for-the-first-time">
<span id="first"></span><h2>Running the NLDS client for the first time<a class="headerlink" href="#running-the-nlds-client-for-the-first-time" title="Permalink to this heading"></a></h2>
<p>Once the NLDS client is successfully installed, the user can run it. It is
recommended that you run the <code class="docutils literal notranslate"><span class="pre">init</span></code> command first, which will fill in the url
and authentication sections of the <code class="docutils literal notranslate"><span class="pre">.nlds-config</span></code> file for you - see the
<a class="reference internal" href="configuration.html#init"><span class="std std-ref">relevant section</span></a> for details.</p>
<p>Once initialised, the first time <code class="docutils literal notranslate"><span class="pre">nlds</span></code> is run on JASMIN the user will be
asked for their username and password. These are the JASMIN username and
password, which the user usually uses to login into JASMIN via
<a class="reference external" href="https://help.jasmin.ac.uk/docs/interactive-computing/login-servers/">one of the login servers</a>.</p>
<p>The following message will be displayed:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>This application uses OAuth2 to authenticate with the server on your behalf.
To do this it needs your username and password.
Your password is not stored.  It is used to obtain an access token, which is stored in the file: ~/.nlds-token
Username:
Password:
</pre></div>
</div>
<p>After entering your JASMIN username and password, the OAuth2 token is created
at the path pointed to by <code class="docutils literal notranslate"><span class="pre">oauth_token_file_location</span></code> in the <code class="docutils literal notranslate"><span class="pre">~/.nlds-config</span></code>
file.  The NLDS authorisation system uses refresh tokens to fetch a new token
when the current one has expired.</p>
</section>
<section id="how-the-nlds-data-catalog-is-organised">
<span id="catalog"></span><h2>How the NLDS data catalog is organised<a class="headerlink" href="#how-the-nlds-data-catalog-is-organised" title="Permalink to this heading"></a></h2>
<p>When a user PUTs files into the NLDS, a record of those files is kept in a data
catalog.  This organises the files into <em>Holdings</em>, <em>Transactions</em> and <em>Files</em>,
with the ability to add metadata to the <em>Holdings</em> in the form of <em>Tags</em> and
<em>Labels</em>.</p>
<p>Figure 2 shows a simplified view of the NLDS data-catalog.  This is covered in
much more depth in the <a class="reference internal" href="catalog_organisation.html#catalog-organisation"><span class="std std-ref">Catalog Organisation</span></a> section.</p>
<figure class="align-default" id="id3">
<img alt="_images/simple_catalog.png" src="_images/simple_catalog.png" />
<figcaption>
<p><span class="caption-text">Figure 2: Simplified view of the NLDS data-catalog</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="getting-help-on-the-nlds-commands">
<span id="help"></span><h2>Getting help on the NLDS commands<a class="headerlink" href="#getting-help-on-the-nlds-commands" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">--help</span></code> option can be used in conjunction with any command to get help
on that specific command.  To get a list of commands, just use the <code class="docutils literal notranslate"><span class="pre">--help</span></code>
option.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds --help

Usage: nlds [OPTIONS] COMMAND [ARGS]...

Options:
-v, --version  Output NLDS client version and exit.
--help         Show this message and exit.

Commands:
find     Find and list files.
get      Get a single file.
getlist  Get a number of files specified in a list.
init     Set up the NLDS client on first use.
list     List holdings.
meta     Alter metadata for a holding.
put      Put a single file.
putlist  Put a number of files specified in a list.
stat     List transactions.
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds find --help

Usage: nlds find [OPTIONS]

Find and list files. If no user or group is given then these values will
default to the user:default_user and user:default values in the ~/.nlds-
config file.

Options:
-u, --user TEXT                 The username to find files for.
-g, --group TEXT                The group to find files for.
-A, --groupall                  Find files that belong to a group, rather
                                than a single user
-l, --label TEXT                The label of the holding which the files
                                belong to.  This can be a regular expression
                                (regex) if the -x/--regex flag is also used.
-i, --holding_id INTEGER        The numeric id of the holding which the
                                files belong to.
-n, --transaction_id TEXT       The UUID transaction id of the transaction
                                to list.
-p, --path TEXT                 The path of the files to find.  This can be
                                a regular expression (regex) if the
                                -x/--regex flag is also used.
-t, --tag TAG                   The tag(s) of the holding(s) to find files
                                within.
-j, --json                      Output the result as JSON.
-1, --simple                    Output the list of files, one per line,
                                filepath only.
-U, --url                       Output the URL for the file on the object
                                storage.
-x, --regex                     Use regular expressions in the path and
                                label search terms.
-L, --limit INTEGER             Limit the number of files to list.  Default
                                is 1000 files.
-9, --descending / -0, --ascending
                                Switch between ascending and descending time
                                order.
--help                          Show this message and exit.
</pre></div>
</div>
</section>
<section id="copying-a-single-file-put-to-the-nlds">
<span id="put"></span><h2>Copying a single file (PUT) to the NLDS<a class="headerlink" href="#copying-a-single-file-put-to-the-nlds" title="Permalink to this heading"></a></h2>
<p>To put a single file into the NLDS use the command:</p>
<p><code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">nlds</span> <span class="pre">put</span> <span class="pre">&lt;filepath&gt;</span></code></p>
<p>This is the simplest form of the command and will PUT the file into a holding
with a seemingly random label.  It will also use the values of <code class="docutils literal notranslate"><span class="pre">user</span></code> and
<code class="docutils literal notranslate"><span class="pre">group</span></code> from the <a class="reference internal" href="configuration.html#configuration"><span class="std std-ref">Configuration File</span></a>.</p>
<p>To specify the <code class="docutils literal notranslate"><span class="pre">user</span></code> and <code class="docutils literal notranslate"><span class="pre">group</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">nlds</span> <span class="pre">put</span> <span class="pre">-u</span> <span class="pre">&lt;name&gt;</span> <span class="pre">-g</span> <span class="pre">&lt;group&gt;</span> <span class="pre">&lt;filepath&gt;</span></code></p>
<p>To give the newly created holding a sensible label:</p>
<p><code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">nlds</span> <span class="pre">put</span> <span class="pre">-l</span> <span class="pre">&lt;label&gt;</span> <span class="pre">&lt;filepath&gt;</span></code></p>
<p>(<code class="docutils literal notranslate"><span class="pre">-u</span></code> and <code class="docutils literal notranslate"><span class="pre">-g</span></code> can also be used at the same time as <code class="docutils literal notranslate"><span class="pre">-l</span></code>).</p>
<p>To add tags to the holding while PUTting a file to the NLDS:</p>
<p><code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">nlds</span> <span class="pre">put</span> <span class="pre">-l</span> <span class="pre">&lt;label&gt;</span> <span class="pre">-t</span> <span class="pre">&lt;key:value&gt;</span> <span class="pre">&lt;filepath&gt;</span></code></p>
<p>(<code class="docutils literal notranslate"><span class="pre">-l</span></code> is optional here).</p>
<p>To specify a job label use <code class="docutils literal notranslate"><span class="pre">-b</span> <span class="pre">&lt;job_label&gt;</span></code>.  This is a convenience function
for the user to allow them to group multiple transactions under a single
<code class="docutils literal notranslate"><span class="pre">job_label</span></code>.</p>
<p>To get the return output from the <code class="docutils literal notranslate"><span class="pre">put</span></code> command in JSON format, specify the
<code class="docutils literal notranslate"><span class="pre">-j</span></code> option.</p>
<p>When a command is invoked, NLDS will return a summary of the command, including
the <code class="docutils literal notranslate"><span class="pre">transaction_id</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds put -l SheepPen /Users/frjohn/sheep.txt -u frjohn -g farmers -b SheepHerding -t sheepdog:skye
PUT transaction accepted for processing.
    user            : frjohn
    group           : farmers
    action          : put
    job label       : SheepHerding
    transaction id  : c31abca8-2bc4-43dc-ac64-7d28359d6828
    label           : SheepPen
    tags            : sheepdog : skye
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On JASMIN, NLDS cannot transfer data from the user’s home directory (<code class="docutils literal notranslate"><span class="pre">$HOME</span></code> or <code class="docutils literal notranslate"><span class="pre">~/</span></code>), as only the user has permission to read or write to their own home directory.  NLDS can be used with a Group Workspace (GWS), and with the transfer cache (XFC).</p>
</div>
</section>
<section id="copying-a-list-of-files-putlist-to-the-nlds">
<span id="putlist"></span><h2>Copying a list of files (PUTLIST) to the NLDS<a class="headerlink" href="#copying-a-list-of-files-putlist-to-the-nlds" title="Permalink to this heading"></a></h2>
<p>To PUT more than one file into the NLDS, use the <code class="docutils literal notranslate"><span class="pre">putlist</span></code> command.  This
takes the same options as the <code class="docutils literal notranslate"><span class="pre">put</span></code> command but, rather than taking the path
of a single file as an argument, it takes the name of a plain text file which
contains the paths of the files to PUT into the NLDS.  This <em>filelist</em> file must
be in plain text format, with the path of a single file per line, for example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/Users/frjohn/albatross.txt
/Users/frjohn/rabbit.txt
</pre></div>
</div>
<p>The command and response then becomes (where <code class="docutils literal notranslate"><span class="pre">test_putlist</span></code> is the name of the
above file):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds putlist -l Zoo test_list -u frjohn -g farmers -b test_putlist -t zoo:Bristol
PUT transaction accepted for processing.
    user            : frjohn
    group           : farmers
    action          : put
    job label       : test_putlist
    transaction id  : 41d412e2-1c1b-4d59-943a-40d9e717a0a1
    label           : Zoo
    tags            : zoo : Bristol
</pre></div>
</div>
</section>
<section id="querying-the-status-of-a-transaction-stat">
<span id="stat"></span><h2>Querying the status of a transaction (STAT)<a class="headerlink" href="#querying-the-status-of-a-transaction-stat" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">put</span></code> and <code class="docutils literal notranslate"><span class="pre">putlist</span></code> commands above create transactions.  These are
actions in the NLDS that carry out a specific task, usually either a <code class="docutils literal notranslate"><span class="pre">put</span></code>,
<code class="docutils literal notranslate"><span class="pre">putlist</span></code>, <code class="docutils literal notranslate"><span class="pre">get</span></code> or <code class="docutils literal notranslate"><span class="pre">getlist</span></code> command.  To view the status of a
transaction, use the <code class="docutils literal notranslate"><span class="pre">stat</span></code> command.  Invoke the <code class="docutils literal notranslate"><span class="pre">stat</span></code> command on its
own to view the state of all the transactions for a user:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds stat
State of transactions for user:frjohn, group:farmers
    user        id    action          job label       label           done  state                  last update
    frjohn      1     put             SheepHerding    SheepPen        100%  COMPLETE               2023-04-18 15:21:41
    frjohn      2     put             test_putlist    Zoo             100%  COMPLETE               2023-04-18 15:28:53
</pre></div>
</div>
<p>(the <code class="docutils literal notranslate"><span class="pre">user_name</span></code> and <code class="docutils literal notranslate"><span class="pre">group</span></code> have not been specified with the <code class="docutils literal notranslate"><span class="pre">-u</span></code> and
<code class="docutils literal notranslate"><span class="pre">-g</span></code> arguments here, and so the defaults are read from the
<a class="reference internal" href="configuration.html#configuration"><span class="std std-ref">Configuration File</span></a>.)</p>
<p>This table shows the numeric <code class="docutils literal notranslate"><span class="pre">id</span></code>, the <code class="docutils literal notranslate"><span class="pre">action</span></code> which created the
transaction, the user-specified <code class="docutils literal notranslate"><span class="pre">job</span> <span class="pre">label</span></code>, the holding <code class="docutils literal notranslate"><span class="pre">label</span></code>, the last
time the <code class="docutils literal notranslate"><span class="pre">state</span></code> was updated and the <code class="docutils literal notranslate"><span class="pre">state</span></code> of the transaction.</p>
<p>As the transaction is processed by the NLDS, it goes through a number of
<em>states</em> and will end with a <em>terminating state</em>.  All possible <em>states</em> are
listed on the <a class="reference internal" href="status_codes.html#status-codes"><span class="std std-ref">Status Codes</span></a> page.  The <em>terminating states</em> are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">COMPLETE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FAILED</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPLETE_WITH_ERRORS</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPLETE_WITH_WARNINGS</span></code></p></li>
</ul>
<p>Results for the <code class="docutils literal notranslate"><span class="pre">stat</span></code> command can be filtered using the following options:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-b</span></code> : filter on the user-specified <code class="docutils literal notranslate"><span class="pre">job</span> <span class="pre">label</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-s</span></code> : filter on the <code class="docutils literal notranslate"><span class="pre">state</span></code>.  See <a class="reference internal" href="status_codes.html#status-codes"><span class="std std-ref">Status Codes</span></a> for a list of possible values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-a</span></code> : filter on the API action. Options are <code class="docutils literal notranslate"><span class="pre">get</span></code>, <code class="docutils literal notranslate"><span class="pre">put</span></code> <code class="docutils literal notranslate"><span class="pre">getlist</span></code> and <code class="docutils literal notranslate"><span class="pre">putlist</span></code>.</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds stat -s COMPLETE
State of transactions for user:frjohn, group:farmers, state:COMPLETE
    user        id    action          job label       label           done  state                  last update
    frjohn      1     put             SheepHerding    SheepPen        100%  COMPLETE               2023-04-18 15:21:41
    frjohn      2     put             test_putlist    Zoo             100%  COMPLETE               2023-04-18 15:28:53

&gt; nlds stat -a put
State of transactions for user:frjohn, group:farmers, api-action:put
    user        id    action          job label       label           done  state                  last update
    frjohn      1     put             SheepHerding    SheepPen        100%  COMPLETE               2023-04-18 15:21:41
    frjohn      2     put             test_putlist    Zoo             100%  COMPLETE               2023-04-18 15:28:53

&gt; nlds stat -b SheepHerding
State of transaction for user:frjohn, group:farmers
    id              : 1
    user            : frjohn
    group           : farmers
    action          : put
    transaction id  : ebb89e7d-5671-41f9-9f42-968fa69b0c87
    label           : SheepPen
    creation time   : 2023-04-18 15:21:36
    state           : COMPLETE
</pre></div>
</div>
<p>In the last example, only one transaction was found, and so the entire details
for a single transaction was returned.  If more than one transaction had the
same <code class="docutils literal notranslate"><span class="pre">job_label</span></code>, then the list format would be returned.</p>
<p>To guarantee to get the full information for a single transaction, the <code class="docutils literal notranslate"><span class="pre">-i</span></code>
option can be used with the numeric id of the transaction.  The <code class="docutils literal notranslate"><span class="pre">-n</span></code> option
can also be used with the transaction id, if you know it.  Finally, the <code class="docutils literal notranslate"><span class="pre">-S</span></code>
option lists the subrecords of the transaction.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds stat -i 2 -S
State of transaction for user:frjohn, group:farmers, id:2
    id              : 2
    user            : frjohn
    group           : farmers
    action          : put
    transaction id  : 41d412e2-1c1b-4d59-943a-40d9e717a0a1
    label           : Zoo
    creation time   : 2023-04-18 15:28:48
    state           : COMPLETE
    warnings        :
    sub records     -&gt;
    +   id           : 2
        sub_id       : 8d457f6c-f26c-43db-98ff-7c2efe7ff695
        state        : COMPLETE
        retries      : 0
        last update  : 2023-04-18 15:28:53

&gt; nlds stat -n 41d412e2-1c1b-4d59-943a-40d9e717a0a1 -S
State of transaction for user:frjohn, group:farmers, transaction_id:41d412e2-1c1b-4d59-943a-40d9e717a0a1
    id              : 2
    user            : frjohn
    group           : farmers
    action          : put
    transaction id  : 41d412e2-1c1b-4d59-943a-40d9e717a0a1
    label           : Zoo
    creation time   : 2023-04-18 15:28:48
    state           : COMPLETE
    warnings        :
    sub records     -&gt;
    +   id           : 2
        sub_id       : 8d457f6c-f26c-43db-98ff-7c2efe7ff695
        state        : COMPLETE
        retries      : 0
        last update  : 2023-04-18 15:28:53
</pre></div>
</div>
<p>In these last examples, the <code class="docutils literal notranslate"><span class="pre">sub</span> <span class="pre">records</span></code> are present as the NLDS will split
large transactions (with many files, or large files) into smaller units of work,
and create a <code class="docutils literal notranslate"><span class="pre">sub</span> <span class="pre">record</span></code> for each one of them.</p>
<p>Being able to easily check the progress of transactions in the NLDS is a key
design idea.  To enable a program to check the progress, the <code class="docutils literal notranslate"><span class="pre">-j</span></code> option can
be used to return a JSON formatted version of the status.</p>
</section>
<section id="querying-the-file-collections-the-user-holds-on-the-nlds-list">
<span id="list"></span><h2>Querying the file collections the user holds on the NLDS (LIST)<a class="headerlink" href="#querying-the-file-collections-the-user-holds-on-the-nlds-list" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">put</span></code> and <code class="docutils literal notranslate"><span class="pre">putlist</span></code> commands above create holdings in the NLDS
catalog.  Holdings can be thought of as collections of transactions
which, in themselves, are collections of files.  Therefore, a holding
can also be thought of as a collection of files.</p>
<p>To see the holdings that are assigned to a user in NLDS, use the <code class="docutils literal notranslate"><span class="pre">list</span></code>
command.  Invoke the <code class="docutils literal notranslate"><span class="pre">list</span></code> command on its own to see all of the holdings
that a user has:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds list
Listing holdings for user:frjohn, group:farmers
    user        id    label           ingest time
    frjohn      1     SheepPen        2023-04-18 15:21:37
    frjohn      2     Zoo             2023-04-18 15:28:48
</pre></div>
</div>
<p>(the <code class="docutils literal notranslate"><span class="pre">user_name</span></code> and <code class="docutils literal notranslate"><span class="pre">group</span></code> have not been specified with the <code class="docutils literal notranslate"><span class="pre">-u</span></code> and
<code class="docutils literal notranslate"><span class="pre">-g</span></code> arguments here, and so the defaults are read from the
<a class="reference internal" href="configuration.html#configuration"><span class="std std-ref">Configuration File</span></a>.)</p>
<p>This table shows the numeric <code class="docutils literal notranslate"><span class="pre">id</span></code>, <code class="docutils literal notranslate"><span class="pre">label</span></code> and latest <code class="docutils literal notranslate"><span class="pre">ingest</span> <span class="pre">time</span></code> for
the holding.  To examine the holding in more detail, the <code class="docutils literal notranslate"><span class="pre">-i</span></code> option
can be used with the <code class="docutils literal notranslate"><span class="pre">id</span></code>, or the <code class="docutils literal notranslate"><span class="pre">-l</span></code> option can be used with the <code class="docutils literal notranslate"><span class="pre">label</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds list -l SheepPen
    id              : 1
    label           : SheepPen
    ingest time     : 2023-04-18 15:21:37
    transaction id  : ebb89e7d-5671-41f9-9f42-968fa69b0c87
    tags            : sheepdog : skye

&gt; nlds list -i 2 -u frjohn -g farmers
    id              : 2
    label           : Zoo
    ingest time     : 2023-04-18 15:28:48
    transaction id  : 41d412e2-1c1b-4d59-943a-40d9e717a0a1
    tags            : zoo : Bristol
</pre></div>
</div>
<p>Finally, tags can be used to seach for a holding:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds list  -t sheepdog:skye
    Listing holding for user:frjohn, group:farmers, tag:{&#39;sheepdog&#39;: &#39;skye&#39;}
        id              : 1
        label           : SheepPen
        ingest time     : 2023-04-18 15:21:37
        transaction id  : ebb89e7d-5671-41f9-9f42-968fa69b0c87
        tags            : sheepdog : skye
</pre></div>
</div>
</section>
<section id="querying-the-files-the-user-holds-on-the-nlds-find">
<span id="find"></span><h2>Querying the files the user holds on the NLDS (FIND)<a class="headerlink" href="#querying-the-files-the-user-holds-on-the-nlds-find" title="Permalink to this heading"></a></h2>
<p>To view which files the user holds in the NLDS, use the <code class="docutils literal notranslate"><span class="pre">find</span></code> command:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds find
Listing files for holdings for user:frjohn, group:farmers
    user        h-id  h-label         size    date        storage path
    frjohn      1     SheepPen        49.0B   2023-04-18     O    /Users/frjohn/sheep.txt
    frjohn      2     Zoo             96.0B   2023-04-18    O+T   /Users/frjohn/albatross.txt
    frjohn      2     Zoo             50.0B   2023-04-18     L    /Users/frjohn/rabbit.txt
</pre></div>
</div>
<p>The storage column indicates where the file is stored, the possible combinations being:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> O  : Object Storage
O+T : Object Storage and Tape
 T  : Tape only
 L  : File is a link
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Issuing the <code class="docutils literal notranslate"><span class="pre">find</span></code> command like this, with no filters, will
make an attempt to list <em>all</em> of a user’s files, up to a limit of 1000.
This is to prevent a <code class="docutils literal notranslate"><span class="pre">gateway</span> <span class="pre">timeout</span></code>, where the request
takes too long to process, occurring when the user has many files in the NLDS.
To view more files, use the <code class="docutils literal notranslate"><span class="pre">-L</span></code> option with a higher limit set.  Note, that setting
this value high may cause the <code class="docutils literal notranslate"><span class="pre">gateway</span> <span class="pre">timeout</span></code>.
To further refine your search, it is possible to use the options to the <code class="docutils literal notranslate"><span class="pre">find</span></code>
command to limit the number of files that will be returned.  This can be done
in a number of ways, which will be illustrated below.</p>
</div>
<p>To list the files in a holding, use <code class="docutils literal notranslate"><span class="pre">-i</span></code> with the holding id (<code class="docutils literal notranslate"><span class="pre">h-id</span></code>) or
<code class="docutils literal notranslate"><span class="pre">-l</span></code> with the holding label (<code class="docutils literal notranslate"><span class="pre">h-label</span></code>).</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds find -i 1
Listing files for holding for user:frjohn, group:farmers, holding_id:1
    path            : /Users/frjohn/sheep.txt
    type            : FILE
    size            : 49.0B
    user uid        : 0
    group gid       : 20
    permissions     : rw-r--r--
    ingest time     : 2023-04-18 15:21:37
    storage location: OBJECT_STORAGE

&gt; nlds find -l Zoo
Listing files for holding for user:frjohn, group:farmers, label:Zoo
    user        h-id  h-label         size    date        storage path
    frjohn      2     Zoo             96.0B   2023-04-18    O+T   /Users/frjohn/albatross.txt
    frjohn      2     Zoo             50.0B   2023-04-18     L    /Users/frjohn/rabbit.txt
</pre></div>
</div>
<p>In the first example, only one file is returned, so the full details are shown.
To view the particular details of a file in the second example, the <code class="docutils literal notranslate"><span class="pre">filepath</span></code>
of the file can be used with the <code class="docutils literal notranslate"><span class="pre">-p</span></code> argument.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds find -l Zoo -p /Users/frjohn/rabbit.txt
Listing files for holding for user:frjohn, group:farmers, label:Zoo
    path            : /Users/frjohn/rabbit.txt
    type            : FILE
    size            : 50.0B
    user uid        : 504
    group gid       : 20
    permissions     : rw-r--r--
    ingest time     : 2023-04-18 15:28:48
    storage location: OBJECT_STORAGE
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">filepath</span></code> argument can be a regular expression, if the <code class="docutils literal notranslate"><span class="pre">-x</span></code> option is also
given:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds find -l Zoo -p /Users/frjohn/a.* -x
Listing files for holding for user:frjohn, group:farmers, label:Zoo
    path            : /Users/frjohn/albatross.txt
    type            : FILE
    size            : 96.0B
    user uid        : 504
    group gid       : 20
    permissions     : rw-r--r--
    ingest time     : 2023-04-18 15:28:48
    storage location: OBJECT_STORAGE
</pre></div>
</div>
<p>Finally, tags can be used to list files from holdings that contain those tags:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds find  -t zoo:Bristol
Listing files for holding for user:frjohn, group:farmers, tag:{&#39;zoo&#39;: &#39;Bristol&#39;}
    user        h-id  h-label         size    date        storage path
    frjohn      2     Zoo             96.0B   2023-04-18    O+T   /Users/frjohn/albatross.txt
    frjohn      2     Zoo             50.0B   2023-04-18     L    /Users/frjohn/rabbit.txt
</pre></div>
</div>
</section>
<section id="retrieving-a-single-file-from-the-nlds-get">
<span id="get"></span><h2>Retrieving a single file from the NLDS (GET)<a class="headerlink" href="#retrieving-a-single-file-from-the-nlds-get" title="Permalink to this heading"></a></h2>
<p>After the <code class="docutils literal notranslate"><span class="pre">put</span></code> and <code class="docutils literal notranslate"><span class="pre">putlist</span></code> commands above, there are three files in
two holdings in the NLDS, which can be seen by issuing the <code class="docutils literal notranslate"><span class="pre">find</span></code> command.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds find
Listing files for holdings for user:frjohn, group:farmers
    user        h-id  h-label         size    date        storage path
    frjohn      1     SheepPen        49.0B   2023-04-18     O    /Users/frjohn/sheep.txt
    frjohn      2     Zoo             96.0B   2023-04-18     O    /Users/frjohn/albatross.txt
    frjohn      2     Zoo             50.0B   2023-04-18     L    /Users/frjohn/rabbit.txt
</pre></div>
</div>
<p>NLDS supports ways five of retrieving these files, by using the <code class="docutils literal notranslate"><span class="pre">get</span></code> command
in conjunction with:</p>
<ol class="arabic simple">
<li><p>The full file path.</p></li>
<li><p>A regular expression that evaluates to more than one file path.</p></li>
<li><p>A holding id.</p></li>
<li><p>A holding label.</p></li>
<li><p>A holding tag.</p></li>
</ol>
<p>By default the NLDS will try to retrieve the file to the original location
indicated by the <code class="docutils literal notranslate"><span class="pre">path</span></code> field above.  If the user does not wish to overwrite
any file that might now have that filepath, or they do not have permission to
access that filepath, then the optional <em>target directory</em> can be specified with
the option <code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">&lt;target_path&gt;</span></code></p>
<p><strong>1.</strong> To GET a file using the fully qualified filepath, and write it to the
current directory, invoke the command:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds get /Users/frjohn/sheep.txt -r ./
GETLIST transaction accepted for processing.
    user            : frjohn
    group           : farmers
    action          : getlist
    job label       : 14bc9846
    transaction id  : 14bc9846-9d45-440a-af6c-dfcb5cb9dcae
</pre></div>
</div>
<p>This will also recreate the directory structure in the current directory, i.e.
the file will be written to <code class="docutils literal notranslate"><span class="pre">&lt;current_directory&gt;/Users/frjohn/sheep.txt</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On JASMIN, NLDS cannot retrieve data to the user’s home directory (<code class="docutils literal notranslate"><span class="pre">$HOME</span></code> or <code class="docutils literal notranslate"><span class="pre">~/</span></code>), as only the user has permission to read or write to their own home directory.  NLDS can be used to retrieve data to a Group Workspace (GWS), and with the transfer cache (XFC).</p>
</div>
<p>Using this method of retrieval, no holding is specified.  If more than one file
with the filepath is held in the NLDS (in different holdings), then the latest
ingested file will be returned.  See <strong>3. A holding id</strong> or
<strong>4. A holding label</strong> to guarantee that a specific file, ingested at a specific
time is returned.</p>
<p><strong>2.</strong> NLDS understands
<a class="reference external" href="https://en.wikipedia.org/wiki/Regular_expression">regular expressions</a> (regex).
This is a useful tool as it allows a user to get files depending on a pattern.
One use case would be to get all of the files beneath a certain directory.  To
get files using regular expressions, use the <code class="docutils literal notranslate"><span class="pre">-x</span></code> option in conjunction with the
<code class="docutils literal notranslate"><span class="pre">get</span></code> command:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds get -x &quot;/Users/frjohn/.*&quot; -r ./
GETLIST transaction accepted for processing.
    user            : frjohn
    group           : farmers
    action          : getlist
    job label       : 016ae5b7
    transaction id  : 016ae5b7-3b0d-485c-8812-7b3fa1b003de
</pre></div>
</div>
<p>(The <code class="docutils literal notranslate"><span class="pre">Users/frjohn/.*</span></code> has to be in <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> so as to not confuse the shell, which
will see the <code class="docutils literal notranslate"><span class="pre">*</span></code> as a wildcard and try to expand it to all files and directories
in the current path.  Enclosing it in <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> prevents this.)</p>
<p><strong>3.</strong> To ensure that the file at a filepath retrieved from the NLDS is a particular
version, ingested on a particular day, the holding id can be specified in the
<code class="docutils literal notranslate"><span class="pre">get</span></code> command using the option <code class="docutils literal notranslate"><span class="pre">-i</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds get -i 2 /Users/frjohn/albatross.txt -r ./
GETLIST transaction accepted for processing.
    id              : 2
    user            : frjohn
    group           : farmers
    action          : getlist
    job label       : fb130e43
    transaction id  : fb130e43-25a3-4cef-9eeb-b31e72a1f808
</pre></div>
</div>
<p>If the user attempts to get a file from a holding that does not contain it, then
an error will be returned when a <code class="docutils literal notranslate"><span class="pre">stat</span></code> command is used to check the status
of the transaction.  Using the <code class="docutils literal notranslate"><span class="pre">-E</span></code> option shows the errors that occurred during the
transaction.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds get -i 1 /Users/frjohn/albatross.txt
GETLIST transaction accepted for processing.
    id              : 1
    user            : frjohn
    group           : farmers
    action          : getlist
    job label       : 5842d371
    transaction id  : 5842d371-bf07-4ad4-a6ff-c46876a84ca6

&gt; nlds stat -i 13 -E
State of transaction for user:frjohn, group:farmers, id:13
    id              : 13
    user            : frjohn
    group           : farmers
    action          : getlist
    transaction id  : 5842d371-bf07-4ad4-a6ff-c46876a84ca6
    label           :
    creation time   : 2023-04-24 16:01:05
    state           : FAILED
    warnings        :
    sub records     -&gt;
    +   id           : 13
        sub_id       : 85e36999-fc80-4784-acbd-dcc2c9977bbd
        state        : FAILED
        retries      : 6
        last update  : 2023-04-24 16:01:06
        failed files -&gt;
        +   filepath : /Users/frjohn/albatross.txt
            reason   : File:/Users/frjohn/albatross.txt not found in holding:SheepPen for user:frjohn in group:farmers.
</pre></div>
</div>
<p><strong>4.</strong> Similarly to <strong>3</strong>, a label can be used to fetch a particular file from a
holding.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds get -l SheepPen /Users/frjohn/sheep.txt -r ./
GETLIST transaction accepted for processing.
    user            : frjohn
    group           : farmers
    action          : getlist
    job label       : SheepPen
    transaction id  : b0544301-aadb-4f26-b2e0-b4643b0adfee
    label           : SheepPen
</pre></div>
</div>
<p>Again, specifying a label that doesn’t exist or a file that does not exist in
the holding will return an error:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds get -l sheeppen /Users/frjohn/sheep.txt -r ./
GETLIST transaction accepted for processing.
    user            : frjohn
    group           : farmers
    action          : getlist
    job label       : sheeppen
    transaction id  : c07dd223-88cb-41ec-a1e2-00f31c162116
    label           : sheeppen

&gt; nlds stat -i 15 -E
State of transaction for user:frjohn, group:farmers, id:15
    id              : 15
    user            : frjohn
    group           : farmers
    action          : getlist
    transaction id  : c07dd223-88cb-41ec-a1e2-00f31c162116
    label           :
    creation time   : 2023-04-24 16:11:03
    state           : FAILED
    warnings        :
    sub records     -&gt;
    +   id           : 15
        sub_id       : 16759739-bc53-44be-b678-3999d0f7b76b
        state        : FAILED
        retries      : 0
        last update  : 2023-04-24 16:11:04
        failed files -&gt;
        +   filepath : /Users/frjohn/sheep.txt
            reason   : Exception during callback: Could not find record of requested holding: label: sheeppen, id: None
</pre></div>
</div>
<p><strong>5.</strong> Finally, a tag can be specified when retrieving files:</p>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds get -t sheepdog:skye /Users/frjohn/sheep.txt -r ./
GETLIST transaction accepted for processing.
    user            : frjohn
    group           : farmers
    action          : getlist
    job label       : 23db226f
    transaction id  : 23db226f-d377-4511-8cc8-656b006c4f1e
    tags            : sheepdog : skye
</pre></div>
</div>
</div></blockquote>
</section>
<section id="retrieving-a-list-of-files-from-the-nlds-getlist">
<span id="getlist"></span><h2>Retrieving a list of files from the NLDS (GETLIST)<a class="headerlink" href="#retrieving-a-list-of-files-from-the-nlds-getlist" title="Permalink to this heading"></a></h2>
<p>Similarly to how the user can PUT a list of files to the NLDS, the user can also
GET files specified as a list in a text file.  As before, this <em>filelist</em> file
must be in plain text format, with the path of a single file per line, for
example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/Users/frjohn/albatross.txt
/Users/frjohn/rabbit.txt
</pre></div>
</div>
<p>The command and response then becomes the following, where <code class="docutils literal notranslate"><span class="pre">test_getlist</span></code> is the name of the
above file and we give the retrieval a <em>job_label</em> of <code class="docutils literal notranslate"><span class="pre">getlisttest</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds getlist test_list -r ./ -b getlisttest
GETLIST transaction accepted for processing.
    user            : frjohn
    group           : farmers
    action          : getlist
    job label       : getlisttest
    transaction id  : d83d8c2d-7ba8-4be8-b8dd-c643e4bfba49
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">stat</span></code> command can then be used to check on the progress of the retrieval.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds stat -b getlisttest
State of transaction for user:frjohn, group:farmers
    id              : 18
    user            : frjohn
    group           : farmers
    action          : getlist
    transaction id  : d83d8c2d-7ba8-4be8-b8dd-c643e4bfba49
    label           :
    creation time   : 2023-04-25 14:34:37
    state           : COMPLETE
    warnings        :
    sub records     -&gt;
    +    id           : 18
        sub_id       : 419d164a-119a-4e6e-b919-fef154902066
        state        : COMPLETE
        retries      : 0
        last update  : 2023-04-25 14:34:38
</pre></div>
</div>
<p>A holding id or label can be used in conjunction with getlist to make sure that
the correct version of the filepaths in the <em>filelist</em> are retrieved.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds getlist -i 2 test_list -r ./ -b getlist2
GETLIST transaction accepted for processing.
    id              : 2
    user            : frjohn
    group           : farmers
    action          : getlist
    job label       : getlist2
    transaction id  : 441065cb-fc14-4260-9661-2a3b163a5dce
</pre></div>
</div>
<p>However, if the <em>filelist</em> contains files that are not in the holding id, a
different <em>terminating state</em> will be produced for the transaction.  If the
<em>filelist</em> now contains:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/Users/frjohn/albatross.txt
/Users/frjohn/rabbit.txt
/Users/frjohn/sheep.txt
</pre></div>
</div>
<p>and the command is issued:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds getlist -i 1 test_list -r ./ -b getlist3
GETLIST transaction accepted for processing.
    id              : 2
    user            : frjohn
    group           : farmers
    action          : getlist
    job label       : getlist3
    transaction id  : c4c520a1-fd2b-42cd-9a36-32ba94f3b562
</pre></div>
</div>
<p>then the <em>terminating state</em> is <code class="docutils literal notranslate"><span class="pre">COMPLETE_WITH_ERRORS</span></code> because the
<code class="docutils literal notranslate"><span class="pre">/Users/frjohn/sheep.txt</span></code> is not a part of the <code class="docutils literal notranslate"><span class="pre">Zoo</span></code> holding:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds stat -i 22
State of transaction for user:frjohn, group:farmers, id:22
    id              : 22
    user            : frjohn
    group           : farmers
    action          : getlist
    transaction id  : 0f1d711e-6227-4bd9-bd0b-d1b7ed47220f
    label           :
    creation time   : 2023-04-25 14:44:52
    state           : COMPLETE_WITH_ERRORS
    warnings        :
    sub records     -&gt;
    +   id           : 22
        sub_id       : 4c38aab3-16ae-4c21-bce6-9171e15fc231
        state        : COMPLETE
        retries      : 0
        last update  : 2023-04-25 14:44:54
    +   id           : 23
        sub_id       : 668de6ae-7c0e-4763-82bc-ebf7135f4420
        state        : FAILED
        retries      : 6
        last update  : 2023-04-25 14:44:53
        failed files -&gt;
        +   filepath : /Users/frjohn/sheep.txt
            reason   : File:/Users/frjohn/sheep.txt not found in holding:Zoo for user:frjohn in group:farmers.
</pre></div>
</div>
</section>
<section id="changing-the-label-of-a-file-collection-meta">
<span id="label"></span><h2>Changing the label of a file collection (META)<a class="headerlink" href="#changing-the-label-of-a-file-collection-meta" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">meta</span></code> command allows the user to change the label of a holding or alter
the holding’s tags.  Changing the label is particularly useful if an automatically,
seemingly random label has been assigned to the holding:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds list
Listing holdings for user:frjohn, group:farmers
    user        id    label           ingest time
    frjohn      1     SheepPen        2023-04-18 15:21:37
    frjohn      2     Zoo             2023-04-18 15:28:48
    frjohn      3     e4c00744        2023-04-25 15:07:18
</pre></div>
</div>
<p>Here the holding with <code class="docutils literal notranslate"><span class="pre">id</span></code> 3 has the automatically generated label of <code class="docutils literal notranslate"><span class="pre">e4c00744</span></code>.
This can be changed to something more rememberable by using the <code class="docutils literal notranslate"><span class="pre">meta</span></code> command
with the <code class="docutils literal notranslate"><span class="pre">-L</span></code> (for new label) option.  To specify which holding to change the
label for the <code class="docutils literal notranslate"><span class="pre">-i</span></code> (holding id) or <code class="docutils literal notranslate"><span class="pre">-l</span></code> (existing label) options can be used.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds meta -i 3 -L Farm
Changed metadata for holding for user:frjohn, group:farmers, holding_id:3
    id  : 3
        old metadata:
            label   : e4c00744
            tags    : {}
        new metadata:
            label   : Farm
            tags    : {}

&gt; nlds meta -l Farm -L SmallHolding
Changed metadata for holding for user:frjohn, group:farmers, label:Farm
    id  : 3
        old metadata:
            label   : Farm
            tags    : {}
        new metadata:
            label   : SmallHolding
            tags    : {}
</pre></div>
</div>
</section>
<section id="adding-tags-to-a-file-collection-meta">
<span id="tutorial-tags"></span><h2>Adding tags to a file collection (META)<a class="headerlink" href="#adding-tags-to-a-file-collection-meta" title="Permalink to this heading"></a></h2>
<p>In addition to allowing the user to change the label of a holding, the <code class="docutils literal notranslate"><span class="pre">meta</span></code>
command also allows the user to add or alter the holding’s tags.
Tags are specified as <code class="docutils literal notranslate"><span class="pre">key:value</span></code> pairs, and using the <code class="docutils literal notranslate"><span class="pre">-T</span></code> (new tags) option.
For a holding with no tags, specifying tags will add them to the holding:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds meta -l SmallHolding -T type:arable
Changed metadata for holding for user:frjohn, group:farmers, label:SmallHolding
    id  : 3
        old metadata:
            label   : SmallHolding
            tags    : {}
        new metadata:
            label   : SmallHolding
            tags    : {&#39;type&#39;: &#39;arable&#39;}
</pre></div>
</div>
<p>Extra tags can then also be added:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds meta -l SmallHolding -T address:&quot;1 Cow Lane&quot;
Changed metadata for holding for user:frjohn, group:farmers, label:SmallHolding
    id  : 3
        old metadata:
            label   : SmallHolding
            tags    : {&#39;type&#39;: &#39;arable&#39;}
        new metadata:
            label   : SmallHolding
            tags    : {&#39;type&#39;: &#39;arable&#39;, &#39;address&#39;, &#39;1CowLane&#39;}
</pre></div>
</div>
<p>Note that adding tags strips the spaces from any keys or values.
If a holding already has a tag with a key, and the user specifies the key with
a new value, then the tag is modified:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds meta -l SmallHolding -T type:animal
Changed metadata for holding for user:frjohn, group:farmers, label:SmallHolding
    id  : 3
        old metadata:
            label   : SmallHolding
            tags    : {&#39;type&#39;: &#39;arable&#39;, &#39;address&#39;: &#39;1CowLane&#39;}
        new metadata:
            label   : SmallHolding
            tags    : {&#39;type&#39;: &#39;animal&#39;, &#39;address&#39;: &#39;1CowLane&#39;}
</pre></div>
</div>
<p>It is also possible to delete a tag.  Here the <code class="docutils literal notranslate"><span class="pre">-t</span></code> option is used to specify
the holding(s) to delete the tag from, and the <code class="docutils literal notranslate"><span class="pre">-D</span></code> option is used to name the
tag that is to be deleted:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nlds meta -t type:animal -D type:animal
Changed metadata for holding for user:frjohn, group:farmers, tag:{&#39;type&#39;: &#39;animal&#39;}
    id  : 3
        old metadata:
            label   : SmallHolding
            tags    : {&#39;type&#39;: &#39;animal&#39;, &#39;address&#39;: &#39;1CowLane&#39;}
        new metadata:
            label   : SmallHolding
            tags    : {&#39;address&#39;: &#39;1CowLane&#39;}
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="step_by_step.html" class="btn btn-neutral float-left" title="Step-by-Step guide to setting up the NLDS client on JASMIN" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="catalog_organisation.html" class="btn btn-neutral float-right" title="Catalog Organisation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Centre for Environmental Data Analysis, Science and Technologies Facilities Council, UK Research and Innovation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #A6C36F;
    }

    .caption-text {
        color: #828C51
    }

    .wy-nav-side {
        background: #1E352F;
    }

    a {
        color: #828C51
    }

    .note {
        background: #BEEF9E
    }
    .admonition-title {
        background: #335145
    }

  </style>


</body>
</html>